<!-- loader -->
<div id="loader" class="ui dimmer transition active inverted">
    <div class="ui loader"></div>
</div>
<!-- a error on the page -->
<div class="ui error message ng-hide" ng-hide="Model.Error == null">
    <i class="close icon" ng-click="Model.Error = null"></i>
    <div class="header">
        Error
    </div>
    <p>{{Model.Error}}</p>
</div>
<div ng-show="Model.Loaded">
    <!-- panel -->
    <div class="ui three column stackable grid">
        <div class="row">
            <!-- create task -->
            <div class="two wide column">
                <button class="ui primary button" ng-click="CreateTask_OnClick()">Create&nbsp;Task</button>
            </div>
            <!-- filter -->
            <div class="three wide column computer">
                <select id="history-filter" class="ui dropdown streach"
                        ng-model="Model.SelectedHistoryFilter"
                        ng-change="HistoryFilter_OnChange()">
                    <option value="">History Filter</option>
                    <option ng-repeat="(id, name) in Model.HistoryFilters" value="{{id}}">{{name}} - today</option>
                </select>
            </div>
            <div class="three wide column computer">
                <select id="project-filter" class="ui dropdown streach"
                        ng-model="Model.SelectedProjectFilter"
                        ng-change="ProjectFilter_OnChange()">
                    <option value="">Project Filter</option>
                    <option ng-repeat="project in Model.Projects" value="{{project.EntityId}}">{{project.Title}}</option>
                </select>
            </div>
            <div class="three wide column computer">
                <select id="user-filter" class="ui dropdown streach"
                        ng-model="Model.SelectedUserFilter"
                        ng-change="UserFilter_OnChange()">
                    <option value="">Responsible Filter</option>
                    <option ng-repeat="user in Model.Users" value="{{user.Id}}">{{user.UserName}}</option>
                </select>
            </div>
            <div class="two wide column computer">
                <div class="ui button streach"
                     ng-click="ClearFilters_OnClick()">
                    Clear
                </div>
            </div>
            <div class="three wide column computer right aligned">
                <!-- report -->
                <i id="report-filter"
                   class="calendar check large icon"
                   ng-class="Model.ReportFilter ? 'blue' : 'inverted grey'"
                   ng-click="DayReport_OnClick()"
                   title="Reporting tasts"></i>
                <!-- favorite -->
                <i id="favorite-filter"
                   class="favorite large icon"
                   ng-class="Model.FavoriteFilter ? 'yellow' : 'inverted grey'"
                   ng-click="FavoriteFilter_OnClick()"
                   title="Filter by favorites"></i>
                <!-- sorting -->
                <div class="ui right labeled icon button"
                     ng-class="Model.SortBy != 0 ? 'primary' : ''"
                     ng-click="SortBy_OnClick()">
                    <i class="long arrow icon"
                       ng-class="Model.SortBy == 1 || Model.SortBy == 3 || Model.SortBy == 5 ? 'down' : 'up'"></i>
                    {{SortByNames[Model.SortBy]}}
                </div>
            </div>
        </div>
    </div>
    <!-- tasks -->
    <table class="ui celled table flexed">
        <thead>
            <tr>
                <th class="one wide">Tasks</th>
                <th class="three wide left-merge"></th>
                <th class="five wide">Descriptions</th>
                <th class="seven wide">Comments</th>
            </tr>
        </thead>
        <tbody>
            <tr id="task-{{task.EntityId}}" class="top aligned"
                ng-class="task.Status != 0 && task.Status != 1 ? 'disabled1' : ''"
                ng-show="(Model.FavoriteFilter == false || Model.SelectedHistoryFilter != 0 || task.Favorite == Model.FavoriteFilter) &&
                         (Model.SelectedProjectFilter == '' || task.ProjectId == Model.SelectedProjectFilter) &&
                         (Model.SelectedUserFilter == '' || task.UserIds.indexOf(Model.SelectedUserFilter) !== -1)"
                ng-repeat-start="task in Model.FilteredTasks">
                <td colspan="2">
                    <div class="content">
                        <div>
                            <span class="label">Task#</span>&nbsp;
                            <span class="value"><b>{{task.Index}}</b></span>&nbsp;
                            <i id="favorite-{{task.EntityId}}"
                               class="favorite icon"
                               ng-class="task.Favorite ? 'yellow' : 'inverted grey'"
                               ng-click="TaskFavorite_OnClick(task)"
                               title="add to favorite"></i>
                            <div class="pull-right">
                                <a href="" ng-click="CreateSubTask_OnClick(task)">add subtask</a>
                                &nbsp;|&nbsp;
                                <a href="" ng-click="EditTask_OnClick(task)">edit</a>
                            </div>
                        </div>
                        <div>
                            <span class="label">Project</span>&nbsp;
                            <span class="value">{{Model.ProjectName(task.ProjectId)}}</span>
                        </div>
                        <!--<div> not yet used
                            <span class="label">Owner</span>&nbsp;
                            <span class="value">{Model.UserName(task.CreatedById)}</span>
                        </div>-->
                        <div>
                            <span class="label">Created</span>&nbsp;
                            <span class="value">{{task.CreatedDate.format("MM/DD/YYYY")}}</span>,
                            <time class="timeago label" datetime="{{task.CreatedDate.format()}}"></time>
                        </div>
                        <div ng-show="task.CreatedDate.unix() != task.LastModifiedDate.unix()">
                            <span class="label">Modified</span>&nbsp;
                            <span class="value">{{task.LastModifiedDate.format("MM/DD/YYYY")}}</span>,
                            <time class="timeago label" datetime="{{task.LastModifiedDate.format()}}"></time>
                        </div>
                        <!--<div> not yet used
                            <span class="label">Status</span>&nbsp;
                            <span class="value">{TaskStatusNames[task.Status]}</span>
                        </div>-->
                        <div>
                            <span class="label">Urgency</span>&nbsp;
                            <span class="ui tiny label" ng-class="TaskPriorityClasses[task.Priority]">{{TaskPriorityNames[task.Priority]}}</span>
                        </div>
                        <div ng-show="task.TotalWorkHours > 0">
                            <span class="label">Hours (actual / total)</span>&nbsp;
                            <span class="value"
                                  ng-class="task.ActualWorkHours > task.TotalWorkHours ? 'red' : ''">
                                {{task.ActualWorkHours | number:1}}h / {{task.TotalWorkHours | number:1}}h
                            </span>
                        </div>
                        <div ng-show="task.TotalWorkHours == undefined && task.ActualWorkHours != 0">
                            <span class="label">Hours (actual)</span>&nbsp;
                            <span class="value">
                                {{task.ActualWorkHours | number:1}}h
                            </span>
                        </div>
                        <!--<div> not yet used
                            <span class="label">Responsible</span>&nbsp;
                            <span class="value">{Model.UserNames(task.UserIds)}</span>
                        </div>-->
                        <span class="ng-hide">{{task | set_progress_data_percent}}</span>
                        <div class="ui progress green value"
                             ng-hide="task.Progress == 0"
                             id="progress-{{task.EntityId}}">
                            <div class="bar">
                                <div class="progress"></div>
                            </div>
                        </div>
                    </div>
                </td>
                <td class="word_wrap">
                    <p><b>{{task.Title}}</b></p>
                    <p ng-bind-html="task.Description | nl2br"></p>
                    <span class="lightgallery">
                        <a ng-repeat="file in task.GetTaskImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                            {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                        </a>
                    </span>
                    <span>
                        <a ng-repeat="file in task.GetTaskOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                            {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                        </a>
                    </span>
                </td>
                <!-- Task -> Comments -->
                <td class="tasks-comments word_wrap">
                    <div class="item" ng-show="task.Comments.length > 3"
                         ng-class="ShowedAllComments.indexOf(task.EntityId) == -1 ? '' : 'border'">
                        <div class="content">
                            <div class="center aligned">
                                <a href="" ng-click="ToggleAllComments_OnClick(task.EntityId, task.Comments)">
                                    {{ShowedAllComments.indexOf(task.EntityId) == -1 ? 'show all comments' : 'hide comments'}}
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="ui middle aligned divided items block">
                        {{ResetCheckNewValue();""}}
                        <div class="item block" ng-repeat="comment in task.Comments" ng-show="comment.Visible">
                            <div class="content block">
                                <div class="ui small header">{{Model.UserName(comment.CreatedById)}}</div>&nbsp;
                                <span class="label">{{comment.DateMoment.format('MM/DD')}}</span>,&nbsp;
                                <time class="timeago label" datetime="{{comment.LastModifiedDate.format()}}"></time>
                                <div class="inline"
                                     ng-show="comment.CheckByAge()">
                                    &nbsp;|&nbsp;
                                    <a href="" ng-click="EditTaskComment_OnClick(task, comment)">edit</a>
                                </div>
                                <div class="right floated">
                                    <div class="ui label"
                                         ng-class="CheckNewValue('task_status', task.EntityId, comment.Status) ? 'basic blue' : 'basic gray'">
                                        {{TaskStatusNames[comment.Status]}}
                                    </div>
                                    <div class="ui label"
                                         ng-show="comment.ProgressPercent != null"
                                         ng-class="CheckNewValue('task_progress', task.EntityId, comment.Progress) ? 'basic green' : 'basic gray'">
                                        {{comment.ProgressPercent | number:0}}%
                                    </div>
                                    <div class="ui basic brown label"
                                         ng-show="comment.ActualWorkHours != null">
                                        {{comment.ActualWorkHours | number:1}}h
                                    </div>
                                </div>
                                <div class="description block">
                                    <p ng-bind-html="comment.Description | nl2br"></p>
                                </div>
                                <span class="lightgallery">
                                    <a ng-repeat="file in comment.GetCommentImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                        {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                                    </a>
                                </span>
                                <span>
                                    <a ng-repeat="file in comment.GetCommentOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                        {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                                    </a>
                                </span>
                            </div>
                        </div>
                        <div class="item">
                            <div class="content">
                                <a ng-class="task.Status != 0 && task.Status != 1 ? '' : 'ui primary button'"
                                   ng-click="AddTaskComment_OnClick(task)">Add</a>
                            </div>
                        </div>
                        <span class="lightgallery">
                            <a ng-repeat="file in task.GetCommentsImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                            </a>
                        </span>
                        <span>
                            <a ng-repeat="file in task.GetCommentsOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                            </a>
                        </span>
                    </div>
                </td>
            </tr>
            <!-- subtasks -->
            <tr id="subtask-{{subtask.EntityId}}" class="top aligned word_wrap"
                ng-class="subtask.Status != 0 && subtask.Status != 1 ? 'disabled1' : ''"
                ng-show="(Model.FavoriteFilter == false || Model.SelectedHistoryFilter != 0 || subtask.Favorite == Model.FavoriteFilter) &&
                         (Model.SelectedProjectFilter == '' || task.ProjectId == Model.SelectedProjectFilter) &&
                         (Model.SelectedUserFilter == '' || task.UserIds.indexOf(Model.SelectedUserFilter) !== -1)"
                ng-repeat-end ng-repeat="subtask in task.SubTasks">
                <td class="header"></td>
                <td>
                    <div class="content">
                        <div>
                            <span class="label">Index</span>&nbsp;
                            <span class="value"><b>{{task.Index}}</b>/<b>{{subtask.Order}}</b></span>
                            <i id="favorite-{{subtask.EntityId}}"
                               class="favorite icon"
                               ng-class="subtask.Favorite ? 'yellow' : 'inverted grey'"
                               ng-click="SubTaskFavorite_OnClick(task, subtask)"
                               title="add to favorite"></i>
                            <div class="pull-right">
                                <a href="" ng-click="UpSubTask_OnClick(subtask)">up</a>
                                &nbsp;|&nbsp;
                                <a href="" ng-click="DownSubTask_OnClick(subtask)">down</a>
                                &nbsp;|&nbsp;
                                <a href="" ng-click="EditSubTask_OnClick(subtask)">edit</a>
                            </div>
                        </div>
                        <div>
                            <span class="label">Created</span>&nbsp;
                            <span class="value">{{subtask.CreatedDate.format("MM/DD")}}</span>,
                            <time class="timeago label" datetime="{{subtask.CreatedDate.format()}}"></time>
                        </div>
                        <div ng-show="subtask.CreatedDate.unix() != subtask.LastModifiedDate.unix()">
                            <span class="label">Modified</span>&nbsp;
                            <span class="value">{{subtask.LastModifiedDate.format("MM/DD")}}</span>,
                            <time class="timeago label" datetime="{{subtask.LastModifiedDate.format()}}"></time>
                        </div>
                        <!--<div> not yet used
                            <span class="label">Status</span>&nbsp;
                            <span class="value">{TaskStatusNames[subtask.Status]}</span>
                        </div>-->
                        <div ng-show="subtask.TotalWorkHours > 0">
                            <span class="label">Hours (actual / total)</span>&nbsp;
                            <span class="value"
                                  ng-class="subtask.ActualWorkHours > subtask.TotalWorkHours ? 'red' : ''">
                                {{subtask.ActualWorkHours | number:1}}h / {{subtask.TotalWorkHours | number:1}}h
                            </span>
                        </div>
                        <div ng-show="subtask.TotalWorkHours == undefined && subtask.ActualWorkHours != 0">
                            <span class="label">Hours (actual)</span>&nbsp;
                            <span class="value">
                                {{subtask.ActualWorkHours | number:1}}h
                            </span>
                        </div>
                        <span class="ng-hide">{{subtask | set_progress_data_percent}}</span>
                        <div class="ui progress green value"
                             ng-hide="subtask.Progress == 0"
                             id="progress-{{subtask.EntityId}}">
                            <div class="bar">
                                <div class="progress"></div>
                            </div>
                        </div>
                    </div>
                </td>
                <td class="four wide word_wrap">
                    <p><b>{{subtask.Title}}</b></p>
                    <p ng-bind-html="subtask.Description | nl2br"></p>
                    <span class="lightgallery">
                        <a ng-repeat="file in subtask.GetSubTaskImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                            {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                        </a>
                    </span>
                    <span>
                        <a ng-repeat="file in subtask.GetSubTaskOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                            {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                        </a>
                    </span>
                </td>
                <!-- SubTask -> Comments -->
                <td class="tasks-comments word_wrap">
                    <div class="item" ng-show="subtask.Comments.length > 3"
                         ng-class="ShowedAllComments.indexOf(subtask.EntityId) == -1 ? '' : 'border'">
                        <div class="content">
                            <div class="center aligned">
                                <a href="" ng-click="ToggleAllComments_OnClick(subtask.EntityId, subtask.Comments)">
                                    {{ShowedAllComments.indexOf(subtask.EntityId) == -1 ? 'show all comments' : 'hide comments'}}
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="ui middle aligned divided items block">
                        {{ResetCheckNewValue();""}}
                        <div class="item block" ng-repeat="comment in subtask.Comments" ng-show="comment.Visible">
                            <div class="content block">
                                <div class="ui small header">
                                    {{Model.UserName(comment.CreatedById)}}
                                </div>&nbsp;
                                <span class="label">{{comment.DateMoment.format('MM/DD')}}</span>,&nbsp;
                                <time class="timeago label" datetime="{{comment.LastModifiedDate.format()}}"></time>
                                <div class="inline"
                                     ng-show="comment.CheckByAge()">
                                    &nbsp;|&nbsp;
                                    <a href="" ng-click="EditTaskComment_OnClick(subtask, comment)">edit</a>
                                </div>
                                <div class="right floated">
                                    <div class="ui label"
                                         ng-class="CheckNewValue('subtask_status', subtask.EntityId, comment.Status) ? 'basic blue' : 'basic gray'">
                                        {{TaskStatusNames[comment.Status]}}
                                    </div>
                                    <div class="ui label"
                                         ng-show="comment.ProgressPercent != null"
                                         ng-class="CheckNewValue('subtask_progress', subtask.EntityId, comment.Progress) ? 'basic green' : 'basic gray'">
                                        {{comment.ProgressPercent | number:0}}%
                                    </div>
                                    <div class="ui basic brown label"
                                         ng-show="comment.ActualWorkHours != null">
                                        {{comment.ActualWorkHours | number:1}}h
                                    </div>
                                </div>
                                <div class="description block">
                                    <p ng-bind-html="comment.Description | nl2br"></p>
                                </div>
                                <span class="lightgallery">
                                    <a ng-repeat="file in comment.GetCommentImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                        {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                                    </a>
                                </span>
                                <span>
                                    <a ng-repeat="file in comment.GetCommentOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                        {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                                    </a>
                                </span>
                            </div>
                        </div>
                        <div class="item">
                            <div class="content">
                                <a ng-class="subtask.Status != 0 && subtask.Status != 1 ? '' : 'ui primary button'"
                                   ng-click="AddSubTaskComment_OnClick(subtask)">Add</a>
                            </div>
                        </div>
                        <span class="lightgallery">
                            <a ng-repeat="file in subtask.GetCommentsImageFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                            </a>
                        </span>
                        <span>
                            <a ng-repeat="file in subtask.GetCommentsOtherFiles()" class="ui file blue basic label" target="_blank" href="/api/file/download?id={{file.EntityId}}">
                                {{file.DisplayName}}<span class="detail">{{SizeName(file.Size)}}</span>
                            </a>
                        </span>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <hr />
    <footer>
        <p>&copy; 2017 - Enote</p>
    </footer>
</div>
<!-- Edit Task Modal -->
<modal id="edit-task-modal" class="ui big modal" ng-model="Model.EditTask">
    <i class="close icon" ng-click="TaskCancel_OnClick()"></i>
    <div class="header">
        {{Model.EditTask.EntityId == null ? 'Create Task' : 'Edit Task# ' + Model.EditTask.Index}}
        <i class="favorite icon"
           ng-class="Model.EditTask.Favorite ? 'yellow' : 'inverted grey'"
           ng-click="Model.EditTask.Favorite = !Model.EditTask.Favorite"
           title="add to favorite"></i>
    </div>
    <div id="task-form" class="ui validate form content">
        <div class="ui red message ng-hide" ng-hide="Model.EditTask.Error == null">
            <p ng-bind-html="Model.EditTask.Error"></p>
        </div>
        <div class="field">
            <label>Title</label>
            <input id="task-title" placeholder="Title" type="text"
                   ng-model="Model.EditTask.Title">
        </div>
        <div class="field">
            <label>Project</label>
            <select id="task-project" class="ui dropdown"
                    ng-model="Model.EditTask.ProjectId"
                    ng-options="project.EntityId as project.Title for project in Model.Projects">
                <option value="">Project</option>
            </select>
        </div>
        <div class="field">
            <label>Urgency</label>
            <button class="ui button"
                    ng-class="TaskPriorityClasses[Model.EditTask.Priority]"
                    ng-click="TaskPriority_OnClick()">
                {{TaskPriorityNames[Model.EditTask.Priority]}}
            </button>
        </div>
        <div class="field">
            <label>Total Hours</label>
            <div class="ui right labeled input">
                <input id="task-total-hours" placeholder="Total Hours" type="text"
                       ng-model="Model.EditTask.TotalWorkHours"
                       ng-model-options="{ updateOn: 'blur'}">
                <div class="ui label">
                    hours
                </div>
            </div>
        </div>
        <div class="field">
            <label>Responsible</label>
            <select id="task-users" class="ui fluid dropdown" multiple
                    ng-model="Model.EditTask.UserIds"
                    ng-options="user.Id as user.UserName for user in Model.Users">
                <option value="">Responsible</option>
                <!-- NOTES: don't use! ng-model="Model.EditTask.UserIds" is buggy! The modal doesn't closed!
                    <option ng-repeat1="user in Model.Users" value="{user.Id}">{user.UserName}</option> -->
            </select>
        </div>
        <div class="field">
            <label>Description</label>
            <textarea id="task-description" placeholder="Description" rows="2"
                      ng-model="Model.EditTask.Description"></textarea>
        </div>
        <div class="field" id="task-files-field">
            <label>Attachment</label>
            <a ng-repeat1="file in Model.EditTask.Files" class="ui file blue basic label"><span>{{file.DisplayName}}</span><i class="delete icon" ng-click="RemoveFile_OnClick(Model.EditTask.Files, file)"></i></a>
            <div class="ui mini gray button" ng-click="AttachFiles_OnClick(Model.EditTask.Files)">Attach Files</div>
        </div>
        <div class="ui error message"></div>
    </div>
    <div class="actions">
        <div class="ui red button left floated"
             ng-click="TaskDelete_OnClick()"
             ng-show="Model.EditTask.EntityId != null"
             lb-busy="Deleting">
            Delete
        </div>
        <div class="ui clear button"
             ng-click="TaskCancel_OnClick()">
            Cancel
        </div>
        <div class="ui primary button"
             ng-click="TaskOk_OnClick()"
             lb-busy="Saving">
            {{Model.EditTask.EntityId == null ? 'Create' : 'Save'}}
        </div>
    </div>
</modal>
<!-- Edit SubTask Modal -->
<modal id="edit-subtask-modal" class="ui big modal" ng-model="Model.EditSubTask">
    <i class="close icon" ng-click="SubTaskCancel_OnClick()"></i>
    <div class="header">
        {{Model.EditSubTask.EntityId == null ? 'Create SubTask' : 'Edit SubTask# ' + Model.EditSubTask.Order}}
        <i class="favorite icon"
           ng-class="Model.EditSubTask.Favorite ? 'yellow' : 'inverted grey'"
           ng-click="Model.EditSubTask.Favorite = !Model.EditSubTask.Favorite"
           title="add to favorite"></i>
    </div>
    <div id="subtask-form" class="ui validate form content">
        <div class="ui red message ng-hide" ng-hide="Model.EditSubTask.Error == null">
            <p ng-bind-html="Model.EditSubTask.Error"></p>
        </div>
        <div class="field">
            <label>Title</label>
            <input id="subtask-title" placeholder="Title" type="text"
                   ng-model="Model.EditSubTask.Title">
        </div>
        <div class="field">
            <label>Total Hours</label>
            <div class="ui right labeled input">
                <input id="subtask-total-hours" placeholder="Total Hours" type="text"
                       ng-model="Model.EditSubTask.TotalWorkHours"
                       ng-model-options="{ updateOn: 'blur'}">
                <div class="ui label">
                    hours
                </div>
            </div>
        </div>
        <div class="field">
            <label>Description</label>
            <textarea id="subtask-description" placeholder="Description" rows="2"
                      ng-model="Model.EditSubTask.Description"></textarea>
        </div>
        <div class="field" id="task-files-field">
            <label>Attachment</label>
            <a ng-repeat1="file in Model.EditSubTask.Files" class="ui file blue basic label"><span>{{file.DisplayName}}</span><i class="delete icon" ng-click="RemoveFile_OnClick(Model.EditSubTask.Files, file)"></i></a>
            <div class="ui mini gray button" ng-click="AttachFiles_OnClick(Model.EditSubTask.Files)">Attach Files</div>
        </div>
        <div class="ui error message"></div>
    </div>
    <div class="actions">
        <div class="ui red button left floated"
             ng-click="SubTaskDelete_OnClick()"
             ng-show="Model.EditSubTask.EntityId != null"
             lb-busy="Deleting">
            Delete
        </div>
        <div class="ui button"
             ng-click="SubTaskCancel_OnClick()">
            Cancel
        </div>
        <div class="ui primary button"
             ng-click="SubTaskOk_OnClick()"
             lb-busy="Saving">
            {{Model.EditSubTask.EntityId == null ? 'Create' : 'Save'}}
        </div>
    </div>
</modal>
<!-- Edit Comment Modal -->
<modal id="edit-comment-modal" class="ui big modal" ng-model="Model.EditComment">
    <i class="close icon" ng-click="CommentCancel_OnClick()"></i>
    <div class="header">{{(Model.EditComment.EntityId == null ? 'Create Comment on the Task #' : 'Edit Comment on the Task #') + Model.TaskIndexByComment(Model.EditComment)}}</div>
    <div id="comment-form" class="ui validate form content">
        <div class="ui red message ng-hide" ng-hide="Model.EditComment.Error == null">
            <p ng-bind-html="Model.EditComment.Error"></p>
        </div>
        <div class="field">
            <label>Date</label>
            <div class="ui calendar" id="comment-date">
                <div class="ui input left icon">
                    <i class="calendar icon"></i>
                    <input type="text" placeholder="Date">
                </div>
            </div>
        </div>
        <div class="field">
            <label>Status</label>
            <select id="comment-status" class="ui dropdown"
                    ng-model="Model.EditComment.Status" convert-to-number
                    ng-options="id as name for (id, name) in TaskStatusNames"
                    ng-change="CommentStatus_OnChange()"></select>
        </div>
        <div class="field">
            <label>Actual Hours</label>
            <div class="ui right labeled input">
                <input id="comment-actual-hours" placeholder="Actual Hours" type="text"
                       ng-model="Model.EditComment.ActualWorkHours"
                       ng-model-options="{ updateOn: 'blur'}">
                <div class="ui label">
                    hours
                </div>
            </div>
        </div>
        <div class="field">
            <label>Progress</label>
            <div class="ui right labeled input">
                <input id="comment-progress" placeholder="Progress" type="text"
                       ng-model="Model.EditComment.ProgressPercent">
                <div class="ui label">
                    %
                </div>
            </div>
        </div>
        <div class="field">
            <label>Description</label>
            <textarea id="comment-description" placeholder="Description" rows="2"
                      ng-model="Model.EditComment.Description"></textarea>
        </div>
        <div class="field" id="task-files-field">
            <label>Attachment</label>
            <a ng-repeat1="file in Model.EditComment.Files" class="ui file blue basic label"><span>{{file.DisplayName}}</span><i class="delete icon" ng-click="RemoveFile_OnClick(Model.EditComment.Files, file)"></i></a>
            <div class="ui mini gray button" ng-click="AttachFiles_OnClick(Model.EditComment.Files)">Attach Files</div>
        </div>
        <div class="ui error message"></div>
    </div>
    <div class="actions">
        <div class="ui red button left floated"
             ng-click="CommentDelete_OnClick()"
             ng-show="Model.EditComment.EntityId != null"
             lb-busy="Deleting">
            Delete
        </div>
        <div class="ui clear button"
             ng-click="CommentCancel_OnClick()">
            Cancel
        </div>
        <div class="ui primary button"
             ng-click="CommentOk_OnClick()"
             lb-busy="Saving">
            {{Model.EditComment.EntityId == null ? 'Create' : 'Save'}}
        </div>
    </div>
</modal>
<!-- confirm modal -->
<div id="confirm-modal" class="ui mini modal">
    <div class="ui icon header">
        <i class="warning circle icon"></i>
    </div>
    <div class="content">
        <p></p>
    </div>
    <div class="actions">
        <div class="ui deny button">
            No
        </div>
        <div class="ui green ok button">
            <i class="checkmark icon"></i>
            Yes
        </div>
    </div>
</div>
<script language="javascript">
    var form = function () {
        return $('#task-form')
            .form({
                fields: {
                    title: {
                        identifier: 'task-title',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please enter a title'
                            }
                        ]
                    },
                    project: {
                        identifier: 'task-project',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please select a project'
                            }
                        ]
                    },
                    task_users: {
                        identifier: 'task-users',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please choose responsible users'
                            }
                        ]
                    },
                    total_hours: {
                        identifier: 'task-total-hours',
                        rules: [
                            {
                                type: 'regExp[/^[0-9.]{0,10}$/]',
                                prompt: 'Please enter valid total hours'
                            }
                            /* implement regex: Please enter other than zero */
                        ]
                    }
                }
            });
    }
    var form2 = function () {
        return $('#subtask-form')
            .form({
                fields: {
                    title: {
                        identifier: 'subtask-title',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please enter a title'
                            }
                        ]
                    },
                    total_hours: {
                        identifier: 'subtask-total-hours',
                        rules: [
                            {
                                type: 'regExp[/^[0-9.]{0,10}$/]',
                                prompt: 'Please enter valid total hours'
                            }
                        ]
                    }
                }
            });
    }

    $.fn.form.settings.rules.nullablePercent = function (value) {
        return value == null || value === '' || (value >= 0 && value <= 100);
    }

    var form3 = function () {
        return $('#comment-form')
            .form({
                fields: {
                    actual_hours: {
                        identifier: 'comment-actual-hours',
                        rules: [
                            {
                                type: 'regExp[/^[0-9.]{0,10}$/]',
                                prompt: 'Please enter valid actual hours'
                            }
                            /* implement regex: Please enter other than zero */
                        ]
                    },
                    date: {
                        identifier: 'comment-date',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please enter a date'
                            }
                        ]
                    },
                    status: {
                        identifier: 'comment-status',
                        rules: [
                            {
                                type: 'empty',
                                prompt: 'Please enter a status'
                            }
                        ]
                    },
                    progress: {
                        identifier: 'comment-progress',
                        rules: [
                            {
                                type: 'nullablePercent[value]',
                                prompt: 'Please enter valid percent value'
                            }
                        ]
                    }
                }
            });
    }
</script>
